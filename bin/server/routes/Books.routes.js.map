{"version":3,"sources":["../../../src/server/routes/Books.routes.js"],"names":["express","require","router","Router","get","isLogged","req","res","Book","find","then","books","status","json","catch","err","send","errors","message","id","params","findOne","_id","book","post","isCoach","data","body","property","save","patch","Review","$in","reviews","Borrowings","book_id","borrows","module","exports"],"mappings":"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","sourcesContent":["import {isCoach, isLogged} from \"./Middleware.routes\";\nimport Book from \"../models/Book\";\nimport Review from \"../models/Review\";\nimport Borrowings from \"../models/Borrowing\";\n\nconst express = require(\"express\");\n\nlet router = new express.Router();\n\nrouter.get(\"/\", [isLogged], (req, res) => {\n    Book.find()\n        .then(books => {\n            res.status(200).json({books});\n        })\n        .catch(err => {\n            res.status(500).send({errors: [err.message]});\n        });\n});\n\nrouter.get(\"/:id\", [isLogged], (req, res) => {\n    const id = req.params.id;\n\n    Book.findOne({_id: id})\n        .then(book => {\n            res.status(200).json({book});\n        })\n        .catch(err => {\n            res.status(404).json({\n                errors: [\"Le livre n'a pas pu être trouvé!\", err],\n            });\n        });\n});\n\nrouter.post(\"/\", [isLogged, isCoach], (req, res) => {\n    const data = req.body;\n\n    let book = new Book();\n\n    for (let property in data) {\n        book[property] = req.body[property];\n    }\n\n    book.save();\n    res.status(200).json(book);\n});\n\nrouter.patch(\"/:id\", [isLogged, isCoach], (req, res) => {\n    Book.findOne({_id: req.params.id})\n        .then(book => {\n            for (let property in req.body) {\n                book[property] = req.body[property];\n            }\n\n            book.save();\n            res.status(200).send(\"Update succed\");\n        })\n        .catch(err => {\n            res.status(404).send(err);\n        });\n});\n\nrouter.get(\"/reviews/:id\", [isLogged], (req, res) => {\n    Book.findOne({_id: req.params.id})\n        .then(book => {\n            Review.find({_id: {$in: book.reviews}})\n                .then(reviews => {\n                    res.status(200).json({book: book, reviews: reviews});\n                })\n                .catch(err => {\n                    res.status(400).json({errors: [err.message]});\n                });\n        })\n        .catch(err => {\n            res.status(404).send({errors: [err.message]});\n        });\n});\n\nrouter.get(\"/borrowings/:id\", [isLogged], (req, res) => {\n    Borrowings.find({book_id: req.params.id})\n        .then(borrows => {\n            res.status(200).json(borrows);\n        })\n        .catch(err => {\n            res.status(400).json({errors: [err.message]});\n        });\n});\n\nmodule.exports = router;\n"],"file":"Books.routes.js"}