{"version":3,"sources":["../../../src/server/routes/Books.routes.js"],"names":["express","require","router","Router","get","isLogged","req","res","Book","find","then","books","status","json","catch","err","send","errors","message","post","isCoach","data","body","book","property","save","distinct","authors","id","params","findOne","_id","patch","Review","$in","reviews","Borrowings","book_id","borrows","module","exports"],"mappings":"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","sourcesContent":["import {isCoach, isLogged} from \"./Middleware.routes\";\nimport Book from \"../models/Book\";\nimport Review from \"../models/Review\";\nimport Borrowings from \"../models/Borrowing\";\n\nconst express = require(\"express\");\n\nlet router = new express.Router();\n\nrouter.get(\"/\", [isLogged], (req, res) => {\n    Book.find()\n    .then(books => {\n        res.status(200).json({books});\n    })\n    .catch(err => {\n        res.status(500).send({errors: [err.message]});\n    });\n});\n\nrouter.post(\"/\", [isLogged, isCoach], (req, res) => {\n    const data = req.body;\n    \n    let book = new Book();\n    \n    for (let property in data) {\n        book[property] = req.body[property];\n    }\n    \n    book.save();\n    res.status(200).json(book);\n});\n\nrouter.get(\"/authors\", [isLogged], (req, res) => {\n    Book.distinct(\"author\")\n        .then(authors => {\n            res.status(200).json({authors});\n        })\n        .catch(err => {\n            res.status(500).send({errors: [err.message]});\n        });\n});\n\nrouter.get(\"/:id\", [isLogged], (req, res) => {\n    const id = req.params.id;\n\n    Book.findOne({_id: id})\n        .then(book => {\n            res.status(200).json({book});\n        })\n        .catch(err => {\n            res.status(404).json({\n                errors: [\"Le livre n'a pas pu être trouvé!\", err],\n            });\n        });\n});\n\nrouter.patch(\"/:id\", [isLogged, isCoach], (req, res) => {\n    Book.findOne({_id: req.params.id})\n        .then(book => {\n            for (let property in req.body) {\n                book[property] = req.body[property];\n            }\n\n            book.save();\n            res.status(200).send(\"Update succed\");\n        })\n        .catch(err => {\n            res.status(404).send(err);\n        });\n});\n\nrouter.get(\"/reviews/:id\", [isLogged], (req, res) => {\n    Book.findOne({_id: req.params.id})\n        .then(book => {\n            Review.find({_id: {$in: book.reviews}})\n                .then(reviews => {\n                    res.status(200).json({book: book, reviews: reviews});\n                })\n                .catch(err => {\n                    res.status(400).json({errors: [err.message]});\n                });\n        })\n        .catch(err => {\n            res.status(404).send({errors: [err.message]});\n        });\n});\n\nrouter.get(\"/borrowings/:id\", [isLogged], (req, res) => {\n    Borrowings.find({book_id: req.params.id})\n        .then(borrows => {\n            res.status(200).json(borrows);\n        })\n        .catch(err => {\n            res.status(400).json({errors: [err.message]});\n        });\n});\n\nmodule.exports = router;\n"],"file":"Books.routes.js"}